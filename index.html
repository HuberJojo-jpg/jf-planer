<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>JF Ehingen Verwaltung</title>
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/491/491410.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <style>
         :root {
            --fire-red: #e10000;
            --dark-bg: #121212;
            --dark-card: #1e1e1e;
            --dark-text: #d0d0d0;
            --light-bg: #f4f4f4;
            --light-card: #ffffff;
            --light-text: #333;
        }
        
        body {
            font-family: -apple-system, system-ui, sans-serif;
            margin: 0;
            background: var(--light-bg);
            color: var(--light-text);
            transition: 0.3s;
            overflow-x: hidden;
        }
        
        body.dark-mode {
            background: var(--dark-bg);
            color: var(--dark-text);
        }
        
        .sidebar {
            height: 100%;
            width: 0;
            position: fixed;
            z-index: 300;
            top: 0;
            left: 0;
            background: #222;
            overflow-x: hidden;
            transition: 0.3s;
            padding-top: 60px;
        }
        
        .sidebar a,
        .sidebar label {
            padding: 15px 25px;
            color: white;
            display: block;
            cursor: pointer;
            text-decoration: none;
            font-size: 18px;
        }
        
        .sidebar .closebtn {
            position: absolute;
            top: 10px;
            right: 25px;
            font-size: 36px;
        }
        
        .header-nav {
            background: var(--light-card);
            padding: 10px 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        body.dark-mode .header-nav {
            background: var(--dark-card);
            border-bottom: 1px solid #333;
        }
        
        .menu-icon {
            font-size: 28px;
            cursor: pointer;
            color: var(--fire-red);
        }
        
        .view-section {
            display: none;
            padding: 15px;
        }
        
        .view-section.active {
            display: block;
        }
        
        .controls {
            background: var(--light-card);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            align-items: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        }
        
        body.dark-mode .controls {
            background: var(--dark-card);
            border: 1px solid #333;
        }
        
        .controls h2 {
            width: 100%;
            margin: 0 0 10px 0;
            font-size: 1.1rem;
            color: var(--fire-red);
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        
        input,
        select,
        textarea {
            padding: 6px;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 14px;
            box-sizing: border-box;
        }
        
        body.dark-mode input,
        body.dark-mode select,
        body.dark-mode textarea {
            background: #2a2a2a;
            color: white;
            border-color: #444;
        }
        
        button {
            padding: 8px 12px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            color: white;
            cursor: pointer;
            font-size: 13px;
        }
        
        .btn-green {
            background: #28a745;
        }
        
        .btn-blue {
            background: #007bff;
        }
        
        .btn-gray {
            background: #6c757d;
        }
        
        .btn-orange {
            background: #fd7e14;
        }
        
        .btn-red {
            background: #dc3545;
        }
        
        .btn-purple {
            background: #6f42c1;
        }
        
        .btn-cyan {
            background: #17a2b8;
        }
        
        .tab-container {
            display: flex;
            gap: 4px;
            margin-bottom: -1px;
        }
        
        .tab {
            padding: 10px 18px;
            background: #ddd;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            border: 1px solid #ccc;
            border-bottom: none;
        }
        
        body.dark-mode .tab {
            background: #333;
            color: #888;
            border-color: #444;
        }
        
        .tab.active {
            background: var(--light-card);
            color: var(--fire-red);
            border-top: 3px solid var(--fire-red);
        }
        
        body.dark-mode .tab.active {
            background: var(--dark-card);
            color: var(--fire-red);
            border-bottom: 1px solid var(--dark-card);
        }
        
        .table-container {
            background: var(--light-card);
            padding: 8px;
            border-radius: 0 10px 10px 10px;
            overflow-x: auto;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        }
        
        body.dark-mode .table-container {
            background: var(--dark-card);
            border: 1px solid #333;
        }
        
        table {
            border-collapse: collapse;
            min-width: 100%;
        }
        
        th,
        td {
            border: 1px solid #ddd;
            padding: 4px 6px;
            text-align: center;
        }
        
        body.dark-mode th,
        body.dark-mode td {
            border-color: #333;
        }
        
        .sticky-col {
            position: sticky;
            left: 0;
            z-index: 40;
            background: white !important;
            width: 170px;
            min-width: 170px;
            border-right: 2px solid #bbb !important;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
            text-align: left;
            font-weight: bold;
        }
        
        body.dark-mode .sticky-col {
            background: #1e1e1e !important;
            color: white;
            border-right-color: #444 !important;
        }
        
        .header-input {
            text-align: center;
            width: 100%;
            max-width: 115px;
            /* Etwas schmaler f√ºr iPad Chrome */
            border: 1px solid #bbb;
            border-radius: 4px;
            font-weight: bold;
            font-size: 11px;
            height: 24px;
            background: white;
            box-sizing: border-box;
            padding: 0;
            margin: 0 auto;
            display: block;
            min-width: 0;
            /* Wichtig f√ºr Chrome auf iOS */
        }
        
        body.dark-mode .header-input {
            background: #2a2a2a;
            color: white;
            border-color: #444;
        }
        
        .special-header {
            background: #d0e1f9;
            color: #333;
            font-weight: 600;
            font-size: 11px;
            width: 100px;
        }
        
        body.dark-mode .special-header {
            background: #2c3e50;
            color: #ecf0f1;
        }
        
        .search-container {
            position: relative;
            margin: 10px 0;
        }
        
        .search-box {
            width: 100%;
            border: 2px solid var(--fire-red);
            border-radius: 8px;
            padding: 10px 12px 10px 40px;
            font-size: 14px;
            outline: none;
            box-sizing: border-box;
            background: var(--light-card);
        }
        
        body.dark-mode .search-box {
            background: #1a1a1a;
            color: white;
        }
        
        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
            color: #888;
            font-size: 16px;
        }
        
        .status-A {
            background-color: #d4edda !important;
        }
        
        .status-E {
            background-color: #fff3cd !important;
        }
        
        .status-U {
            background-color: #f8d7da !important;
        }
        
        body.dark-mode .status-A {
            background-color: #1b3320 !important;
        }
        
        body.dark-mode .status-E {
            background-color: #3d341a !important;
        }
        
        body.dark-mode .status-U {
            background-color: #3d1a1a !important;
        }
        
        .inv-date-input {
            width: 100%;
            max-width: 110px;
            font-size: 11px;
            height: 26px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
            display: block;
            margin: 0 auto;
            padding: 0;
            /* Speziell f√ºr Chrome/Safari auf iPad */
            line-height: 26px;
            background-color: #fff;
        }
        
        .inv-item-input {
            width: 100%;
            border: none;
            background: transparent;
            font-size: 13px;
            color: inherit;
            height: 24px;
        }
        
        .inventory-comment {
            width: 100%;
            min-height: 40px;
            border: 1px solid #eee;
            background: #fffdf5;
            padding: 4px 6px;
            border-radius: 4px;
            resize: vertical;
            font-size: 12px;
            box-sizing: border-box;
            display: block;
            line-height: 1.3;
        }
        
        body.dark-mode .inventory-comment {
            background: #1a1a1a;
            color: #ccc;
            border-color: #333;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 400;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
        }
        
        .modal-content {
            background: white;
            margin: 15% auto;
            padding: 20px;
            border-radius: 12px;
            width: 280px;
            text-align: center;
        }
        
        body.dark-mode .modal-content {
            background: var(--dark-card);
            color: white;
        }
    </style>
</head>

<body>

    <div id="mySidebar" class="sidebar">
        <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
        <a onclick="showSection('dienstplan')">üìÖ Dienstplan</a>
        <a onclick="showSection('inventar')">üì¶ Inventar</a>
        <div style="padding: 15px 25px;">
            <label style="color: white; font-size: 16px; cursor: pointer;">
                <input type="checkbox" id="darkModeToggle" onchange="toggleDarkMode()"> Dark Mode
            </label>
        </div>
    </div>

    <div class="header-nav">
        <span class="menu-icon" onclick="openNav()">&#9776;</span>
        <img src="https://www.fw-ehingen.de/wp-content/themes/theke-fire/img/fw-logo.svg" alt="Logo" style="height:30px">
        <strong style="color: var(--fire-red); margin-left:10px;">Verwaltung JF Ehingen</strong>
    </div>

    <div class="main-content">
        <section id="dienstplan" class="view-section active">
            <div class="controls">
                <h2>JF Dienstplan</h2>
                <input type="text" id="nameInput" placeholder="Name..." onkeypress="if(event.key === 'Enter') addMember()">
                <button class="btn-green" onclick="addMember()">‚ûï</button>
                <button class="btn-orange" onclick="addSpecialColumn()">‚òëÔ∏è Liste</button>
                <button class="btn-cyan" onclick="showDateModal()">üìÖ Termin+</button>
                <button class="btn-blue" onclick="exportDienstplanCSV()">üíæ Export</button>
                <button class="btn-gray" onclick="toggleConfig()">‚öôÔ∏è Setup</button>

                <div id="configSection" style="display:none; width: 100%; background: rgba(128,128,128,0.1); padding: 12px; border-radius: 8px; margin-top: 10px;">
                    <textarea id="ferienInput" style="width:100%; height:60px; font-size:11px; margin-bottom:10px;">2025-12-22 bis 2026-01-05
2026-03-30 bis 2026-04-11
2026-05-26 bis 2026-06-05
2026-07-30 bis 2026-09-12
2026-10-26 bis 2026-10-31
2026-12-23 bis 2026-12-31</textarea>
                    <div style="display:flex; gap:8px;">
                        <button class="btn-red" style="flex:2" onclick="rebuildCalendar()">Kalender neu berechnen</button>
                        <button class="btn-purple" style="flex:1" onclick="createBackup()">Backup</button>
                        <button class="btn-blue" style="flex:1" onclick="importBackup()">Import</button>
                    </div>
                </div>
            </div>

            <div class="tab-container">
                <div id="tab-Kleine" class="tab active" onclick="switchTab('Kleine')">Kleine</div>
                <div id="tab-Gro√üe" class="tab" onclick="switchTab('Gro√üe')">Gro√üe</div>
                <div id="tab-Betreuer" class="tab" onclick="switchTab('Betreuer')">Betreuer</div>
            </div>

            <div class="table-container">
                <table id="planTable">
                    <thead>
                        <tr id="headerRow"></tr>
                    </thead>
                    <tbody id="memberBody"></tbody>
                </table>
            </div>
        </section>

        <section id="inventar" class="view-section">
            <thead>
                <tr>
                    <th style="width:180px">Gegenstand</th>
                    <th style="width:45px">Anz.</th>
                    <th style="width:115px; text-align: center;">Verliehen am</th>
                    <th>Kommentare</th>
                    <th style="width:40px">üóëÔ∏è</th>
                </tr>
            </thead>

            <div class="search-container">
                <span class="search-icon">üîç</span>
                <input type="text" id="invSearchInput" class="search-box" placeholder="Suche..." onkeyup="renderInventory()">
            </div>

            <div class="table-container">
                <table style="table-layout: fixed;">
                    <thead>
                        <tr>
                            <th style="width:180px">Gegenstand</th>
                            <th style="width:45px">Anz.</th>
                            <th style="width:110px; text-align: center;">Verliehen am</th>
                            <th>Kommentare</th>
                            <th style="width:40px">üóëÔ∏è</th>
                        </tr>
                    </thead>
                    <tbody id="inventoryBody"></tbody>
                </table>
            </div>
        </section>
    </div>

    <div id="dateModal" class="modal">
        <div class="modal-content">
            <h3>Termin hinzuf√ºgen</h3>
            <input type="date" id="newDateInput" style="width:100%; margin-bottom:15px">
            <button class="btn-green" style="width:100%" onclick="addManualDate()">Hinzuf√ºgen</button>
            <button class="btn-gray" style="width:100%; margin-top:5px" onclick="closeDateModal()">Abbrechen</button>
        </div>
    </div>

    <script>
        const STORAGE_KEY = 'jf_ehingen_v39_csv_fix';
        let state = {
            dates: [],
            specials: [],
            members: [],
            currentTab: 'Kleine',
            ferienRaw: "",
            inventory: [],
            darkMode: false
        };

        function init() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                state = JSON.parse(saved);
                if (state.darkMode) {
                    document.body.classList.add('dark-mode');
                    document.getElementById('darkModeToggle').checked = true;
                }
                document.getElementById('ferienInput').value = state.ferienRaw || document.getElementById('ferienInput').value;
                render();
                renderInventory();
            } else {
                rebuildCalendar(false);
            }
        }

        function save() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
        }

        function toggleDarkMode() {
            state.darkMode = document.getElementById('darkModeToggle').checked;
            document.body.classList.toggle('dark-mode', state.darkMode);
            save();
        }

        function openNav() {
            document.getElementById("mySidebar").style.width = "250px";
        }

        function closeNav() {
            document.getElementById("mySidebar").style.width = "0";
        }

        function showSection(id) {
            document.querySelectorAll('.view-section').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            closeNav();
            if (id === 'inventar') renderInventory();
            else render();
        }

        function switchTab(t) {
            state.currentTab = t;
            document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
            document.getElementById('tab-' + t).classList.add('active');
            render();
        }

        function deToIso(de) {
            const p = de.split('.');
            return p.length === 3 ? `${p[2]}-${p[1]}-${p[0]}` : "";
        }

        function isoToDe(iso) {
            const p = iso.split('-');
            return p.length === 3 ? `${p[2]}.${p[1]}.${p[0]}` : iso;
        }

        function sortDates() {
            state.dates.sort((a, b) => new Date(deToIso(a.d)) - new Date(deToIso(b.d)));
        }

        function rebuildCalendar(ask = true) {
            if (ask && !confirm("Kalender neu berechnen? Anwesenheiten gehen verloren.")) return;
            state.ferienRaw = document.getElementById('ferienInput').value;
            const ranges = state.ferienRaw.split('\n').filter(l => l.includes(' bis ')).map(l => {
                const p = l.split(' bis ');
                return {
                    start: p[0].trim(),
                    end: p[1].trim()
                };
            });
            state.dates = [];
            let d = new Date(2026, 0, 1);
            while (d.getDay() !== 2) d.setDate(d.getDate() + 1);
            while (d.getFullYear() === 2026) {
                let y = d.getFullYear(),
                    m = String(d.getMonth() + 1).padStart(2, '0'),
                    day = String(d.getDate()).padStart(2, '0');
                const iso = `${y}-${m}-${day}`;
                const isHoliday = ranges.some(r => iso >= r.start && iso <= r.end);
                if (!isHoliday) state.dates.push({
                    d: isoToDe(iso),
                    t: ""
                });
                d.setDate(d.getDate() + 7);
            }
            state.members.forEach(m => m.attendance = {});
            render();
            if (ask) toggleConfig();
        }

        function render() {
            const header = document.getElementById('headerRow');
            const body = document.getElementById('memberBody');
            let headHTML = `<th class="sticky-col">Name</th><th>A</th><th>E</th><th>U</th><th>%</th>`;
            state.specials.forEach((s, i) => headHTML += `<th class="special-header">${s} <span onclick="removeSpecial(${i})" style="color:red; cursor:pointer">‚úï</span></th>`);
            state.dates.forEach((d, i) => {
                headHTML += `<th style="width:130px">
                    <span onclick="removeDate(${i})" style="color:red; cursor:pointer; float:right; font-size:14px;">‚úï</span>
                    <input type="date" value="${deToIso(d.d)}" class="header-input" onchange="editDate(${i}, 'd', this.value)">
                    <br><input type="text" value="${d.t}" placeholder="Thema..." class="header-input" style="font-weight:normal; margin-top:3px" onchange="editDate(${i}, 't', this.value)">
                </th>`;
            });
            header.innerHTML = headHTML + `<th style="width:50px">üóëÔ∏è</th>`;

            body.innerHTML = '';
            state.members.filter(m => m.category === state.currentTab).forEach((m) => {
                const gIdx = state.members.indexOf(m);
                const attVals = Object.values(m.attendance);
                const a = attVals.filter(v => v === 'A').length,
                    e = attVals.filter(v => v === 'E').length,
                    u = attVals.filter(v => v === 'U').length;
                const total = attVals.filter(v => v !== '-').length;
                const quote = total > 0 ? Math.round((a / total) * 100) : 0;

                let row = `<td class="sticky-col"><input type="text" class="inv-item-input" style="font-weight:bold" value="${m.name}" onchange="state.members[${gIdx}].name=this.value;save()"></td>
                           <td>${a}</td><td>${e}</td><td>${u}</td><td>${quote}%</td>`;

                state.specials.forEach((s, sIdx) => {
                    const chk = (m.specialStates && m.specialStates[sIdx]) ? 'checked' : '';
                    row += `<td><input type="checkbox" ${chk} onchange="state.members[${gIdx}].specialStates[${sIdx}]=this.checked;save()"></td>`;
                });

                state.dates.forEach((d) => {
                    const val = m.attendance[d.d] || '-';
                    row += `<td class="status-${val}"><select onchange="updateAtt(${gIdx}, '${d.d}', this.value)" style="border:none; background:transparent; font-weight:bold; color:inherit; cursor:pointer">
                        <option value="-" ${val==='-'?'selected':''}>-</option><option value="A" ${val==='A'?'selected':''}>A</option><option value="E" ${val==='E'?'selected':''}>E</option><option value="U" ${val==='U'?'selected':''}>U</option>
                    </select></td>`;
                });
                row += `<td><button onclick="deleteMember(${gIdx})" style="background:none; border:none; cursor:pointer; font-size:18px">üóëÔ∏è</button></td>`;
                body.innerHTML += `<tr>${row}</tr>`;
            });
            save();
        }

        function renderInventory() {
            const body = document.getElementById('inventoryBody');
            const q = document.getElementById('invSearchInput').value.toLowerCase();
            body.innerHTML = '';
            state.inventory.forEach((item, idx) => {
                if (item.name.toLowerCase().includes(q) || item.log.toLowerCase().includes(q)) {
                    body.innerHTML += `<tr>
                        <td><input type="text" class="inv-item-input" value="${item.name}" onchange="state.inventory[${idx}].name=this.value;save()"></td>
                        <td><input type="text" style="width:100%; border:none; background:transparent; color:inherit; text-align:center" value="${item.amount}" onchange="state.inventory[${idx}].amount=this.value;save()"></td>
                        <td><input type="date" style="width:100%; border:none; background:transparent; color:inherit" value="${item.loanDate}" onchange="state.inventory[${idx}].loanDate=this.value;save()"></td>
                        <td><textarea class="inventory-comment" onchange="state.inventory[${idx}].log=this.value;save()">${item.log}</textarea></td>
                        <td><button onclick="state.inventory.splice(${idx},1);renderInventory();save()" style="background:none; border:none; cursor:pointer; font-size:18px">üóëÔ∏è</button></td>
                    </tr>`;
                }
            });
        }

        function updateAtt(mI, dateStr, v) {
            state.members[mI].attendance[dateStr] = v;
            render();
        }

        function addInventoryItem() {
            const val = document.getElementById('itemInput').value;
            if (!val) return;
            state.inventory.push({
                name: val,
                amount: "1",
                loanDate: "",
                log: ""
            });
            document.getElementById('itemInput').value = '';
            renderInventory();
            save();
        }

        function addMember() {
            const n = document.getElementById('nameInput').value;
            if (!n) return;
            state.members.push({
                name: n,
                category: state.currentTab,
                attendance: {},
                specialStates: []
            });
            document.getElementById('nameInput').value = '';
            render();
        }

        function removeDate(i) {
            if (confirm("Termin l√∂schen?")) {
                const d = state.dates[i].d;
                state.members.forEach(m => delete m.attendance[d]);
                state.dates.splice(i, 1);
                render();
            }
        }

        function deleteMember(i) {
            if (confirm("L√∂schen?")) {
                state.members.splice(i, 1);
                render();
            }
        }

        function editDate(i, f, v) {
            if (f === 'd') {
                const old = state.dates[i].d,
                    nD = isoToDe(v);
                state.members.forEach(m => {
                    if (m.attendance[old]) {
                        m.attendance[nD] = m.attendance[old];
                        delete m.attendance[old];
                    }
                });
                state.dates[i].d = nD;
                sortDates();
            } else {
                state.dates[i].t = v;
            }
            save();
            render();
        }

        function showDateModal() {
            document.getElementById('dateModal').style.display = 'block';
        }

        function closeDateModal() {
            document.getElementById('dateModal').style.display = 'none';
        }

        function addManualDate() {
            const v = document.getElementById('newDateInput').value;
            if (v) {
                state.dates.push({
                    d: isoToDe(v),
                    t: ""
                });
                sortDates();
                closeDateModal();
                render();
            }
        }

        function addSpecialColumn() {
            const title = prompt("Titel:");
            if (title) {
                state.specials.push(title);
                state.members.forEach(m => {
                    if (!m.specialStates) m.specialStates = [];
                    m.specialStates.push(false);
                });
                render();
            }
        }

        function removeSpecial(i) {
            state.specials.splice(i, 1);
            state.members.forEach(m => m.specialStates.splice(i, 1));
            render();
        }

        function toggleConfig() {
            const s = document.getElementById('configSection');
            s.style.display = s.style.display === 'block' ? 'none' : 'block';
        }

        function createBackup() {
            const code = btoa(unescape(encodeURIComponent(JSON.stringify(state))));
            navigator.clipboard.writeText(code).then(() => alert("Backup-Code kopiert!"));
        }

        function importBackup() {
            const code = prompt("Code:");
            if (code) {
                try {
                    state = JSON.parse(decodeURIComponent(escape(atob(code))));
                    render();
                    renderInventory();
                } catch (e) {
                    alert("Fehler!");
                }
            }
        }

        // REPARIERTER VOLLST√ÑNDIGER EXPORT
        function exportDienstplanCSV() {
            let csv = "\uFEFF"; // BOM f√ºr Excel UTF-8 Erkennung
            // Header Zeile 1: Spaltenbeschriftungen
            let header = ["Name", "Kategorie", "A", "E", "U", "Quote %"];
            state.specials.forEach(s => header.push(s));
            state.dates.forEach(d => header.push(d.d + (d.t ? " (" + d.t + ")" : "")));
            csv += header.join(";") + "\r\n";

            // Daten Zeilen
            state.members.forEach(m => {
                const vals = Object.values(m.attendance);
                const a = vals.filter(v => v === 'A').length;
                const e = vals.filter(v => v === 'E').length;
                const u = vals.filter(v => v === 'U').length;
                const total = vals.filter(v => v !== '-').length;
                const quote = total > 0 ? Math.round((a / total) * 100) : 0;

                let row = [
                    m.name,
                    m.category,
                    a, e, u,
                    quote + "%"
                ];

                // Checkbox-Listen Status
                state.specials.forEach((_, sIdx) => {
                    row.push((m.specialStates && m.specialStates[sIdx]) ? "JA" : "NEIN");
                });

                // Einzelne Termine Status
                state.dates.forEach(d => {
                    row.push(m.attendance[d.d] || "-");
                });

                csv += row.join(";") + "\r\n";
            });

            downloadBlob(csv, "Dienstplan_Ehingen_Vollstaendig.csv");
        }

        function exportInventoryCSV() {
            let csv = "\uFEFFGegenstand;Menge;VerliehenAm;Kommentare\r\n";
            state.inventory.forEach(i => {
                csv += [
                    i.name,
                    i.amount,
                    i.loanDate,
                    i.log.replace(/(\r\n|\n|\r|;)/gm, " ") // Entfernt Zeilenumbr√ºche und Semikolons
                ].join(";") + "\r\n";
            });
            downloadBlob(csv, "Inventar_Ehingen.csv");
        }

        function downloadBlob(content, filename) {
            const blob = new Blob([content], {
                type: 'text/csv;charset=utf-8;'
            });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            link.click();
        }

        window.onload = init;
    </script>
</body>

</html>
